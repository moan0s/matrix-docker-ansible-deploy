#jinja2: lstrip_blocks: "True"
[Unit]
Description=Matrix registration bot
{% for service in matrix_bot_matrix_registration_bot_systemd_required_services_list %}
Requires={{ service }}
After={{ service }}
{% endfor %}
{% for service in matrix_bot_matrix_registration_bot_systemd_wanted_services_list %}
Wants={{ service }}
{% endfor %}
DefaultDependencies=no

[Service]
Type=simple
Environment="HOME={{ matrix_systemd_unit_home_path }}"
ExecStartPre=-{{ matrix_host_command_sh }} -c '{{ matrix_host_command_docker }} kill matrix-bot-matrix-registration-bot 2>/dev/null || true'
ExecStartPre=-{{ matrix_host_command_sh }} -c '{{ matrix_host_command_docker }} rm matrix-bot-matrix-registration-bot 2>/dev/null || true'

ExecStart={{ matrix_host_command_docker }} run --rm --name matrix-bot-matrix-registration-bot \
			--log-driver=none \
			--cap-drop=ALL \
			--network={{ matrix_docker_network }} \
			-e 'BOT_SERVER=https://{{ matrix_server_fqn_matrix }}' \
			-e 'BOT_USERNAME={{ matrix_bot_matrix_registration_bot_matrix_user_id_localpart }}' \
			-e 'BOT_PASSWORD={{ matrix_bot_matrix_registration_bot_matrix_user_password }}' \
			-e 'API_BASE_URL=https://{{ matrix_server_fqn_matrix }}' \
			-e 'API_TOKEN={{ matrix_bot_matrix_registration_bot_matrix_admin_token }}' \
			-e 'LOGGING_LEVEL=info' \
			{{ matrix_bot_matrix_registration_bot_docker_image }}

ExecStop=-{{ matrix_host_command_sh }} -c '{{ matrix_host_command_docker }} kill matrix-bot-matrix-registration-bot 2>/dev/null || true'
ExecStop=-{{ matrix_host_command_sh }} -c '{{ matrix_host_command_docker }} rm matrix-bot-matrix-registration-bot 2>/dev/null || true'
Restart=always
RestartSec=30
SyslogIdentifier=matrix-bot-matrix-registration-bot

[Install]
WantedBy=multi-user.target
